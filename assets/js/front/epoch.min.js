function epoch_ucwords(a){return(a+"").replace(/^([a-z])|\s+([a-z])/g,function(a){return a.toUpperCase()})}Handlebars.registerHelper("epochLink",function(a,b,c,d,e,f){b=b.replace(/-comment_date-/g,this.comment_date),b in epoch_translation&&(b=epoch_translation[b]),c in epoch_translation&&(c=epoch_translation[c]),b=new Handlebars.SafeString(b),a=!a||/^\s*$/.test(a)?"#":Handlebars.Utils.escapeExpression(a),c=Handlebars.Utils.escapeExpression(c);var g='<a href="'+a+'" title="'+c+'"';return!f||/^\s*$/.test(f)||(f=Handlebars.Utils.escapeExpression(f),g+=' rel="'+f+'"'),"string"!=typeof e||!e||/^\s*$/.test(e)||(e=Handlebars.Utils.escapeExpression(e),g+=' target="'+e+'"'),"string"!=typeof d||!d||/^\s*$/.test(d)||(d=Handlebars.Utils.escapeExpression(d),g+=' class="'+d+'"'),g+=" >"+b+"</a>",new Handlebars.SafeString(g)}),Handlebars.registerHelper("epochTranslation",function(a){return string="",a in epoch_translation&&(string=epoch_translation[a]),new Handlebars.SafeString(string)}),jQuery(document).ready(function(a){!function(a,b){b.init=function(){b.form_wrap_el=document.getElementById(epoch_vars.form_wrap),b.comments_wrap_el=document.getElementById(epoch_vars.comments_wrap),b.template_el=document.getElementById(epoch_vars.comments_template_id),b.count_el=document.getElementById(epoch_vars.count_id),b.last_count=0,b.highest_id=0,b.no_comments=!1,b.comments_close=!1,b.shut_it_off=!1,b.form_el=document.getElementById(epoch_vars.form_id),null!=b.form_el&&(b.form_el.removeAttribute("action"),b.form_el.setAttribute("action","post")),b.set_width(),b.comments_open(),b.comment_count(!1),window.onresize=function(a){b.set_width()},Visibility.every(epoch_vars.epoch_options.interval,function(){0==b.shut_it_off&&b.comment_count(!0)}),a(b.form_el).submit(function(c){c.preventDefault(),b.shut_it_off=!0,fail=!1,fail_log="",a(b.form_el).find("select, textarea, input").each(function(){a(this).prop("required")&&(a(this).val()||(fail=!0,name=epoch_ucwords(a(this).attr("name")),fail_log+=name+" "+epoch_translation.is_required+".\n"))}),fail?(a(b.form_wrap_el,"textarea#comment").addClass("epoch-failure").delay(100).queue(function(b){a(this).removeClass("epoch-failure"),b()}),alert(fail_log)):(a(b.form_el).find('input[type="submit"]').attr("disabled","disabled"),data=a(this).serializeArray(),a.post(epoch_vars.submit_api_url,data).complete(function(){a(b.form_el).find('input[type="submit"]').removeAttr("disabled")}).success(function(c){return c.success?(a("textarea#comment").val(""),a("#comment_parent").val("0"),temp_el=document.getElementById("wp-temp-form-div"),null!=temp_el&&(respond_el=document.getElementById("respond"),a(respond_el).insertAfter(temp_el)),b.set_last_count(b.last_count+1),c=b.get_data_from_response(c),comment=c.comment,id=parseInt(comment.comment_ID,10),b.highest_id<id&&(b.highest_id=id),null==document.getElementById("comment-"+comment.comment_ID)&&(html=b.parse_comment(comment),b.put_comment_in_dom(html,comment.comment_parent,comment.depth,id),comment_el=document.getElementById("comment-"+comment.comment_ID),null!=comment_el&&a(comment_el).addClass("epoch-success").delay(100).queue(function(b){a(this).removeClass("epoch-success"),b()})),void(b.shut_it_off=!1)):(alert(epoch_translation.comment_rejected),!1)}).fail(function(c){c.responseJSON&&c.responseJSON.data&&c.responseJSON.data.message&&alert(a("<div/>").html(c.responseJSON.data.message).text()),a(b.form_wrap_el,"textarea#comment").addClass("epoch-failure").delay(100).queue(function(b){a(this).removeClass("epoch-failure"),b()})}))})},b.comments_open=function(){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"comments_open",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),1==a?b.shut_it_off=!1:b.comments_closed=!0})},b.comment_count=function(c){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"comment_count",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),"undefined"!=a.count&&0<a.count?(c?a.count>b.last_count&&b.new_comments():b.get_comments(),b.set_last_count(a.count)):b.no_comments=!0,b.shut_it_off=!1})},b.get_comments=function(){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"get_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:0}).done(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),b.comment_response(a,!1)})},b.comment_response=function(c,d){if("object"==typeof c&&"undefined"!=c&&"undefined"!=c.comments&&(comments=c.comments,comments=JSON.parse(comments),depth=epoch_vars,"undefined"!==comments&&0<comments.length)){var e=[],f=[];a.each(comments,function(a,c){id=parseInt(c.comment_ID,10),b.highest_id<id&&(b.highest_id=id),0==c.comment_parent?e.push(c):f.push(c)}),"ASC"==epoch_vars.epoch_options.order?(f.reverse(),e.reverse()):f.reverse(),a.each(e,function(c,e){html=b.parse_comment(e),b.put_comment_in_dom(html,e.comment_parent,e.depth,parseInt(e.comment_ID,10)),d&&(comment_el=document.getElementById("comment-"+e.comment_ID),null!=comment_el&&a(comment_el).addClass("epoch-success").delay(100).queue(function(b){a(this).removeClass("epoch-success"),b()}))}),a.each(f,function(a,c){html=b.parse_comment(c),b.put_comment_in_dom(html,c.comment_parent,c.depth,parseInt(c.comment_ID,10))})}},b.new_comments=function(){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"new_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:b.highest_id}).done(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),b.comment_response(a,!0)})},b.get_data_from_response=function(a){return a.data},b.parse_comment=function(c){return parent_id=c.comment_parent,source=a(b.template_el).html(),template=Handlebars.compile(source),html=template(c),html},b.put_comment_in_dom=function(c,d,e,f){0==comment.comment_parent&&"DESC"==epoch_vars.epoch_options.order?(first_child=b.comments_wrap_el.firstChild,new_el=document.createElement("div"),new_el.innerHTML=c,b.comments_wrap_el.insertBefore(new_el,first_child)):0==d?a(c).appendTo(b.comments_wrap_el):(c='<div class="epoch-child child-of-'+d+" level-"+e+' ">'+c+"</div>",parent_el=document.getElementById("comment-"+d),null!=parent_el?a(c).appendTo(parent_el):a(c).appendTo(b.comments_wrap_el)),a(".comment-reply-link").click(function(a){a.preventDefault()})},b.set_width=function(){el=document.getElementById(epoch_vars.sniffer),null!=el&&(content_width=a(el).parent().outerWidth(),"number"==typeof content_width&&(wrap_el=document.getElementById(epoch_vars.wrap_id),a(wrap_el).css("width",content_width)))},b.set_last_count=function(c){b.last_count=c,a(b.count_el).text(c)}}(jQuery,window.Epoch||(window.Epoch={}))}),jQuery(function(){Epoch.init()});